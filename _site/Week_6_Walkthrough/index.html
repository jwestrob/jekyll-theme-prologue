<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Week 6 Walkthrough- Phylogenetic Tree Building &#8211; Jacob West-Roberts</title> <meta name="description" content="Moon is a minimal, one column jekyll theme for your blog."> <meta name="keywords" content="test"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="/assets/img/nerd.jpg"> <meta name="twitter:title" content="Week 6 Walkthrough- Phylogenetic Tree Building"> <meta name="twitter:description" content="Phylogenetics!"> <meta name="twitter:site" content="@jwestrob"> <meta name="twitter:creator" content="@jwestrob"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Week 6 Walkthrough- Phylogenetic Tree Building"> <meta property="og:description" content="Phylogenetics!"> <meta property="og:url" content="/Week_6_Walkthrough/"> <meta property="og:site_name" content="Jacob West-Roberts"> <meta property="og:image" content="/assets/img/nerd.jpg"> <link rel="canonical" href="/Week_6_Walkthrough/"> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Jacob West-Roberts Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- JS --> <script src="/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="/favicon.png" /> <link rel="shortcut icon" href="/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(/assets/img/pretty_tree_cropped_smaller.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="/assets/img/nerd.jpg" alt="Jacob West-Roberts photo" class="author-photo"> <h4>Jacob West-Roberts</h4> <p>Moon is a minimal, one column jekyll theme for your blog.</p> </li> <li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/jwestrob" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://github.com/jwestrob" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="/posts/">All Posts</a></li> <li><a href="/tags/">All Tags</a></li> </ul> </li> <li><a href="/projects/" >Projects</a></li> <li><a href="/ESPM_112L/" >ESPM_112L</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Week 6 Walkthrough- Phylogenetic Tree Building</h1> <h4>01 Mar 2021</h4> <a class="btn zoombtn" href="/projects/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>``</p> <h1>Hello and welcome to week 6 of ESPM 112L-</h1> <h1>Metagenomic Data Analysis Lab!</h1> <ul id="markdown-toc"> <li><a href="#whats-required-to-perform-phylogenetic-analysis" id="markdown-toc-whats-required-to-perform-phylogenetic-analysis">What’s required to perform phylogenetic analysis?</a></li> <li><a href="#what-software-will-we-be-using-to-get-this-info" id="markdown-toc-what-software-will-we-be-using-to-get-this-info">What software will we be using to get this info?</a></li> <li><a href="#getting-your-sequences" id="markdown-toc-getting-your-sequences">Getting your sequences</a></li> <li><a href="#aligning-your-sequences" id="markdown-toc-aligning-your-sequences">Aligning your sequences</a> <ul> <li><a href="#cat" id="markdown-toc-cat"><code class="highlighter-rouge">cat</code></a></li> </ul> </li> <li><a href="#visualizing-your-alignment-local-system" id="markdown-toc-visualizing-your-alignment-local-system">Visualizing your alignment (local system)</a></li> <li><a href="#creating-a-phylogenetic-tree-back-on-the-cluster" id="markdown-toc-creating-a-phylogenetic-tree-back-on-the-cluster">Creating a phylogenetic tree (back on the cluster)</a></li> <li><a href="#visualizing-your-tree" id="markdown-toc-visualizing-your-tree">Visualizing your tree</a> <ul> <li><a href="#uploading-your-tree-to-itol" id="markdown-toc-uploading-your-tree-to-itol">Uploading your tree to iTOL</a></li> <li><a href="#interpreting-your-trees" id="markdown-toc-interpreting-your-trees">Interpreting your trees</a></li> <li><a href="#finding-cool-stuff-in-your-tree" id="markdown-toc-finding-cool-stuff-in-your-tree">Finding cool stuff in your tree</a></li> </ul> </li> </ul> <p>This week we’re going to be going over some material that’s very near and dear to my heart… phylogenetics!</p> <p>A lot of microbial ecology research revolves around phylogenetic analysis, especially my own. So what is it, exactly?</p> <p>Phylogenetics is basically the process by which we estimate relationships between organisms. In the case of today’s lab, we’ll be using it to measure the relationships between bacteria in your baby gut samples.</p> <h3 id="whats-required-to-perform-phylogenetic-analysis">What’s required to perform phylogenetic analysis?</h3> <div class="highlighter-rouge"><pre class="highlight"><code>- A sequence set (DNA or protein)
- A multiple sequence alignment program
- An alignment (made by using the two previously mentioned items)
- Phylogenetic tree estimation software (FastTree, iQ-TREE, RAxML, etc)
- Phylogenetic tree visualization software (iTOL, FigTree, etc)
</code></pre></div> <h3 id="what-software-will-we-be-using-to-get-this-info">What software will we be using to get this info?</h3> <div class="highlighter-rouge"><pre class="highlight"><code>- Sequence set: ggKbase
- Multiple sequence alignment: Mafft and FAMSA (both on the cluster)
  - Mafft: https://mafft.cbrc.jp/alignment/software/
  - FAMSA: https://github.com/refresh-bio/FAMSA (Wicked fast!)
- Alignment viewer: Aliview (https://ormbunkar.se/aliview/)
- Tree building: FastTree (on cluster)
- Tree visualization: iTOL (http://itol.embl.de)
</code></pre></div> <hr /> <h1 id="getting-your-sequences">Getting your sequences</h1> <p>Log in to class.ggkbase.berkeley.edu on your browser, navigate to your baby’s project page, and click “Genome Completeness -&gt; Ribosomal Proteins” near the top of the page. You’ll see a menu that looks like this:</p> <p>&lt;img src=”/assets/img/ggkbase_rps3.png” width=250&gt;</p> <p>Click “Protein” and a file will be generated and downloaded to your computer. Now you’re going to want to put that file on the cluster with cyberduck or scp.</p> <hr /> <h1 id="aligning-your-sequences">Aligning your sequences</h1> <p>Now log in to class.ggkbase.berkeley.edu on the terminal. Again, make sure you’ve put your sequence file you’ve downloaded from ggKbase onto the class server!</p> <p>We’ve got a bunch of reference sequences for you to include on your phylogenetic tree; what we’re going to do is combine the rps3 file for your sample with this reference file. This is done by concatenating, using the command <code class="highlighter-rouge">cat</code>.</p> <h3 id="cat"><code class="highlighter-rouge">cat</code></h3> <p>The <code class="highlighter-rouge">cat</code> command is very useful, and good to be familiar with. <code class="highlighter-rouge">cat</code> literally means <code class="highlighter-rouge">concatenate</code>; it’s meant to stick one or more files together into a single, bigger file, which is just what you’re going to be doing with it.</p> <p>However, it’s important to point out that <code class="highlighter-rouge">cat</code> also prints the entire text of a file to terminal. Not always ideal- most of the time you’d rather use <code class="highlighter-rouge">head</code> to view just the first 5 lines of a file (or <code class="highlighter-rouge">tail</code> to view the last 5). However, you can use this in combination with other bash commands to perform more complex tasks, so it’s good to know going forward.</p> <p>Here’s how to concatenate your rps3 file with our reference:</p> <div class="highlighter-rouge"><pre class="highlight"><code> #This creates a file called 'rps3_wRef.faa' by combining your ggKbase rps3 file and the reference Bacteroidetes.faa
cat [YOUR RPS3 FILENAME] /class_data/Bacteroidetes.faa &gt; rps3_wRef.faa
</code></pre></div> <p>Mafft is a popular aligner renowned for its accuracy and thoroughness when creating alignments. It takes a while, though, since it was written with accuracy in mind. Try aligning your sequences with <code class="highlighter-rouge">mafft</code>:</p> <p><code class="highlighter-rouge">mafft --localpair --maxiterate 1000 --reorder --thread 4 rps3_wRef.faa &gt; rps3_wRef.mafft.mfaa</code></p> <p>This alignment should take around 4-5 minutes; if it runs longer, don’t be too concerned.</p> <p>Remember to choose a name for your alignment and to end that filename with <code class="highlighter-rouge">.fna</code> or <code class="highlighter-rouge">.mfna</code>. I prefer to use <code class="highlighter-rouge">.mfna</code> because that means (to me) that it’s a multiple sequence alignment (<code class="highlighter-rouge">m</code> for multiple) of nucleotide sequences (<code class="highlighter-rouge">fna</code> for <strong>f</strong>asta <strong>a</strong>mino <strong>a</strong>cid). Just makes things easier later. A protein multiple sequence alignment, for example, would be <code class="highlighter-rouge">.mfaa</code>. It makes it easier to identify what’s in your files, since a FASTA file can be DNA, RNA or protein!</p> <hr /> <h1 id="visualizing-your-alignment-local-system">Visualizing your alignment (local system)</h1> <p>On your local computer, install Aliview, which we’ll be using to view your alignment: https://ormbunkar.se/aliview/</p> <p>Now use cyberduck or SCP to download your multiple sequence alignment to your computer. Open Aliview, and use it to open this multiple sequence alignment file. What do you see? Are there regions of conservation? Is it particularly gappy? This is just to give you an idea of what your data looks like and what you’re actually working with.</p> <p>You may want to delete partial sequences- i.e. rows that are comprised primarily of gaps- before building your tree.</p> <p>It’s common practice to trim your alignment before building a phylogenetic tree- that is, to remove columns from your alignment that consist primarily of gaps. This often helps to construct more reliable and robust trees, but the best way to do this is subject of debate within the field. It’s also quite common to trim specifically at the beginning and end of the alignment.</p> <hr /> <h1 id="creating-a-phylogenetic-tree-back-on-the-cluster">Creating a phylogenetic tree (back on the cluster)</h1> <p>Now that you’re back on the cluster, make a folder to do your tree analysis in. Phylogenetic tree building software gets a little messy sometimes and we don’t want to get confused about what files go where. It’s good to keep your home directory tidy.</p> <p>Make a directory for this analysis (with <code class="highlighter-rouge">mkdir</code>) and move (<code class="highlighter-rouge">mv</code>) your DNA alignment into this folder. Now navigate in there (<code class="highlighter-rouge">cd</code>).</p> <p>You’re going to be using FastTree as your tree building software today- here’s an example command.</p> <p><code class="highlighter-rouge">fasttree rps3_wRef.mafft.mfaa &gt; rps3_wRef.mafft.mfaa.treefile</code></p> <p>This should be very fast- less than a minute.</p> <p>Now remember, when you use <code class="highlighter-rouge">&gt;</code>, you’re creating a new file! So the above command is creating a file called <code class="highlighter-rouge">rps3_wRef.mafft.mfaa.treefile</code>. (You can name that file whatever you want, by the way, I just want to be consistent for the purposes of the tutorial.)</p> <hr /> <h1 id="visualizing-your-tree">Visualizing your tree</h1> <p>One of the best ways to visualize trees is with a website called iTOL. This site has recently moved to a subscription service, so you don’t get all the functionality with a free account, but it’s perfectly sufficient for our purposes today. You’re going to make an account, upload your tree, and send it to me as part of your turnin today.</p> <h2 id="uploading-your-tree-to-itol">Uploading your tree to iTOL</h2> <p>First, download your treefile to your local computer using cyberduck/SCP. Then, go to <img src="https://itol.embl.de/" alt="iTOL" /> and click ‘Register’ at the top right of the page to create an account.</p> <p>Once you’ve created an account, log in; this will take you to a page containing two buttons, “Paste tree text” and “Upload tree files”. Click “Upload tree files” and upload the tree file you just downloaded from the class server.</p> <h2 id="interpreting-your-trees">Interpreting your trees</h2> <p>For those of you not in the lecture, we’ve talked a lot about trees, and so if you don’t have experience interpreting these, you might be at somewhat of a disadvantage- call me over at this step if you’d like to learn more about what’s going on here.</p> <p>I will do a live demo of this in lab, and come around for help, since this might be the tricky portion of today’s lab.</p> <p>First, now that you’ve uploaded your tree file, click on the link and go view it. You should see a circular representation, with a bunch of impossible-to-read small text- don’t worry about that just yet.</p> <p>There’s a box at the upper right of the page that looks like this:</p> <p>&lt;img src=’/assets/img/itol_box.png’ width=250&gt;</p> <p>Select “Unrooted” (as in the example above) and the tree should look like this:</p> <p>&lt;img src=’/assets/img/itol_unrooted.png’ width=250&gt;</p> <h2 id="finding-cool-stuff-in-your-tree">Finding cool stuff in your tree</h2> <p>Find a branch that particularly interests you- I pick from clades with the longest branches, because long branches indicate highly divergent sequences. The vast majority of your sequences will be from bacteria, which shouldn’t surprise you- but there’s more than just bacteria in here.</p> <p>Click on the branch you’d like to investigate, or the text label for that branch (call me over if you have trouble with this), and click the blue text at the bottom of the resulting window, like so:</p> <p>&lt;img src=’/assets/img/itol_copy.png’ width=250&gt;</p> <p>As an example, the branch I copied looks like this:</p> <div class="highlighter-rouge"><pre class="highlight"><code>scaffold_383062_77|metabat_scaffolds2bin_tsv_074|JS_HB1_S134
</code></pre></div> <p>But we just want the part before the first <code class="highlighter-rouge">|</code> character, i.e.</p> <div class="highlighter-rouge"><pre class="highlight"><code>scaffold_383062_77
</code></pre></div> <p>Go back to class.ggkbase.berkeley.edu, and in the top left search bar, paste that sequence ID…. what’s the taxonomy for that protein? Go to the contig- is it in a bin?</p> <p>See if you can find an archaeon among one of your longest branches. There are archaea in gut microbiomes- they’re just not abundant!</p> <hr /> <hr /> <p>Today’s turnin:</p> <ol> <li> <p>Send me the URL for your tree.</p> </li> <li> <p>Search at least three proteins on ggkbase using the method I described above using scaffold_383062_77 as an example and send me the taxonomy for each one.</p> </li> <li> <p>How many columns are in your alignment? (Open it in aliview on your local machine and scroll all the way to the right!)</p> </li> </ol> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="/tags/#test" title="Pages tagged test" class="tag"><span class="term">test</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=/Week_6_Walkthrough/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=/Week_6_Walkthrough/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=/Week_6_Walkthrough/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="/assets/js/jquery-1.12.0.min.js"></script> <script src="/assets/js/jquery.dlmenu.min.js"></script> <script src="/assets/js/jquery.goup.min.js"></script> <script src="/assets/js/jquery.magnific-popup.min.js"></script> <script src="/assets/js/jquery.fitvid.min.js"></script> <script src="/assets/js/scripts.js"></script> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
