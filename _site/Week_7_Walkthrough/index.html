<!DOCTYPE html> <!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]--> <!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8"><![endif]--> <!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9"><![endif]--> <!--[if gt IE 8]><!--> <html class="no-js"><!--<![endif]--> <head> <meta charset="UTF-8"> <meta content="text/html; charset=UTF-8" http-equiv="Content-Type"> <meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"> <title>Week 7 Walkthrough- Dereplication and Genome Comparison &#8211; Jacob West-Roberts</title> <meta name="description" content="Moon is a minimal, one column jekyll theme for your blog."> <meta name="keywords" content="test"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="/assets/img/nerd.jpg"> <meta name="twitter:title" content="Week 7 Walkthrough- Dereplication and Genome Comparison"> <meta name="twitter:description" content="dRep!"> <meta name="twitter:site" content="@jwestrob"> <meta name="twitter:creator" content="@jwestrob"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Week 7 Walkthrough- Dereplication and Genome Comparison"> <meta property="og:description" content="dRep!"> <meta property="og:url" content="/Week_7_Walkthrough/"> <meta property="og:site_name" content="Jacob West-Roberts"> <meta property="og:image" content="/assets/img/nerd.jpg"> <link rel="canonical" href="/Week_7_Walkthrough/"> <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Jacob West-Roberts Feed"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- CSS --> <link rel="stylesheet" href="/assets/css/main.css"> <!-- JS --> <script src="/assets/js/modernizr-3.3.1.custom.min.js"></script> <!-- Favicons --> <link rel="apple-touch-icon" href="/assets/img/favicons/apple-icon-precomposed.png"> <link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicons/apple-icon-72x72.png"> <link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicons/apple-icon-114x114.png"> <link rel="apple-touch-icon" sizes="144x144" href="/assets/img/favicons/apple-icon-144x144.png"> <link rel="shortcut icon" type="image/png" href="/favicon.png" /> <link rel="shortcut icon" href="/favicon.ico" /> <!-- Background Image --> <style type="text/css">body {background-image:url(/assets/img/pretty_tree_cropped_smaller.jpg); background-repeat: no-repeat; background-size: cover; }</style> <!-- Post Feature Image --> </head> <body> <nav id="dl-menu" class="dl-menuwrapper" role="navigation"> <button class="dl-trigger">Open Menu</button> <ul class="dl-menu"> <li><a href="/">Home</a></li> <li> <a href="#">About</a> <ul class="dl-submenu"> <li> <img src="/assets/img/nerd.jpg" alt="Jacob West-Roberts photo" class="author-photo"> <h4>Jacob West-Roberts</h4> <p>Moon is a minimal, one column jekyll theme for your blog.</p> </li> <li><a href="/about/"><span class="btn btn-inverse">Learn More</span></a></li> <li> <a href="http://twitter.com/jwestrob" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-twitter-square"></i> Twitter</a> </li> <li> <a href="http://github.com/jwestrob" target="_blank" rel="noopener noreferrer"><i class="fa fa-fw fa-github"></i> Github</a> </li> </ul><!-- /.dl-submenu --> </li> <li> <a href="#">Posts</a> <ul class="dl-submenu"> <li><a href="/posts/">All Posts</a></li> <li><a href="/tags/">All Tags</a></li> </ul> </li> <li><a href="/projects/" >Projects</a></li> <li><a href="/ESPM_112L/" >ESPM_112L</a></li> </ul><!-- /.dl-menu --> </nav><!-- /.dl-menuwrapper --> <!-- Header --> <header class="header" role="banner"> <div class="wrapper animated fadeIn"> <div class="content"> <div class="post-title "> <h1>Week 7 Walkthrough- Dereplication and Genome Comparison</h1> <h4>04 Mar 2021</h4> <a class="btn zoombtn" href="/projects/"> <i class="fa fa-chevron-left"></i> </a> </div> <p>``</p> <h1>Hello and welcome to week 7 of ESPM 112L-</h1> <h1>Metagenomic Data Analysis Lab!</h1> <ul id="markdown-toc"> <li><a href="#how-to-run-drep-for-your-reference" id="markdown-toc-how-to-run-drep-for-your-reference">How to run dRep (for your reference)</a></li> <li><a href="#analyzing-drep-output" id="markdown-toc-analyzing-drep-output">Analyzing dRep output</a> <ul> <li><a href="#downloading-and-viewing-drep-output" id="markdown-toc-downloading-and-viewing-drep-output">Downloading and viewing dRep output</a></li> </ul> </li> <li><a href="#using-ani-clustering-to-make-a-dereplicated-bin-set" id="markdown-toc-using-ani-clustering-to-make-a-dereplicated-bin-set">Using ANI clustering to make a dereplicated bin set</a></li> <li><a href="#comparing-synteny-between-bins-with-at-least-99-ani" id="markdown-toc-comparing-synteny-between-bins-with-at-least-99-ani">Comparing synteny between bins with at least 99% ANI</a> <ul> <li><a href="#important-note-about-file-names" id="markdown-toc-important-note-about-file-names">Important note about file names</a></li> <li><a href="#running-orthologer" id="markdown-toc-running-orthologer">Running orthologer</a></li> </ul> </li> <li><a href="#todays-turn-in" id="markdown-toc-todays-turn-in">Today’s turn-in</a></li> </ul> <p>This week we’re going to be looking at methods of dereplication of metagenomic bins. We often sequence environments that contain lots of very similar microorganisms (E. faecalis, anyone?) and it becomes less than desirable to spend time and effort analyzing a bunch of extremely closely related genomes instead of looking at the general population.</p> <p>For this and other reasons, which I’ll discuss in much more detail in today’s lecture/demo video, we use a program called dRep <img src="https://github.com/MrOlm/drep" alt="https://github.com/MrOlm/drep" /> designed by the inimitable Dr. Matt Olm, a former ESPM 112L GSI and Ph.D. student in the Banfield lab.</p> <p>Today’s lab primarily involves analyzing the output of dRep and interpreting it; this can help give you an idea of which closely-related organisms are present in multiple samples across your dataset.</p> <p>First, let’s go over dRep, how I ran it, and how you can run it (on your own time if you so desire, not during the lab period please!).</p> <p>dRep is a program that utilizes genome wide average nucleotide identity (ANI) to group bins into clusters based on how similar they are. In this way, we can figure out which organisms are present across multiple samples because the bin from each sample will fall into the same ANI cluster.</p> <p>If you want to run dRep on your own, the documentation is here: <img src="https://readthedocs.org/projects/drep/" alt="https://readthedocs.org/projects/drep/" /></p> <hr /> <h1 id="how-to-run-drep-for-your-reference">How to run dRep (for your reference)</h1> <p>dRep uses DNA-DNA comparisons to find very closely related genomes in your dataset. This is performed using MASH, a fast alignment algorithm that gives approximate (i.e. not entirely perfect) comparisons between two genome-size chunks of DNA in a reasonable period of time. This is a really hard task, and takes a very long time if you do it exactly!</p> <p>What you’re going to see today are clustering results; this is done by taking the similarities between genomes and clustering them into highly related groups. First, “primary” clusters are formed out of loosely related organisms, then more stringent comparisons are done among these smaller clusters.</p> <p>The secondary clusters use a different algorithm, gANI, to perform similarity comparisons- this gives more accurate values, and is only feasible when run on a small number of genomes.</p> <p>dRep is run using genome fasta files containing DNA (not protein) data. You call the program by saying <code class="highlighter-rouge">dRep dereplicate</code>, provide an output directory name (I call it <code class="highlighter-rouge">dRep_output</code>), and a folder full of genomes (<code class="highlighter-rouge">-g all_contigs/*.fasta</code>). In this case I put all the bins for all samples in a single folder and ran dRep on that.</p> <p>The <code class="highlighter-rouge">-p</code> flag refers to the number of threads you’re using- be careful not to use too many if you’re running this on your local machine. If you’re running it on the cluster, 24 is the maximum number available, and remember not to use those all at once if others are using the cluster too.</p> <p>Here’s the final command:</p> <div class="highlighter-rouge"><pre class="highlight"><code>dRep dereplicate dRep_output -g all_contigs/*.fasta -p 24
</code></pre></div> <hr /> <h1 id="analyzing-drep-output">Analyzing dRep output</h1> <p>Now you can go in and look at what dRep has generated after comparing all of the bins from all 9 of our samples. Go ahead and navigate to <code class="highlighter-rouge">/class_data/dRep_output</code> and take a look. The <code class="highlighter-rouge">dereplicated_genomes/</code> folder contains the genomes dRep has chosen as representatives- i.e. the best genome for each group. The <code class="highlighter-rouge">figures/</code> folder has all the pictures you’ll need to look at in the following section. Remember, to download any of these pictures, here’s what to do:</p> <h2 id="downloading-and-viewing-drep-output">Downloading and viewing dRep output</h2> <p>Download the files <code class="highlighter-rouge">Primary_clustering_dendrogram.pdf</code> and <code class="highlighter-rouge">Secondary_clustering_dendrograms.pdf</code>. Let’s take a look at them.</p> <p>The primary clustering dendrogram is a clustering of the bins based off of MASH. It should look something like the following and have every bin from every sample in a single dendrogram:</p> <p>&lt;img src=”/assets/img/mash_primary_clustering.png” width=250&gt;</p> <p>The secondary clustering dendrogram is the ANI clustering performed on each of the identified MASH clusters. This file should contain quite a few different dendrograms, each relating to a different MASH cluster and should look something like the following for a single cluster:</p> <p>&lt;img src=”/assets/img/second_dendrogram.png” width=250&gt;</p> <p>We generally consider bins that share 99% or greater ANI to be from very closely related organisms (i.e. same species). In the above secondary clustering example, all of those bins would be considered to be from the same set of closely related organisms. In the below example, there are bins from two different organisms present:</p> <p>&lt;img src=”/assets/img/third_dendrogram.png” width=250&gt;</p> <p>If you don’t understand why there are two groups in this clustering please ask me. This is an important concept to understand. The important part is being able to read a dendrogram- the vertical line at 99% ANI indicates a dividing line between the two groups (on top, the Lentimicrobium group and on bottom, the Bacteroidetes group).</p> <h1 id="using-ani-clustering-to-make-a-dereplicated-bin-set">Using ANI clustering to make a dereplicated bin set</h1> <p>This secondary clustering file is what we will use to create a dereplicated bin set across all 17 samples. We will consider bins that share 99% or greater ANI to be from the same organism type. With that in mind, all we need to do to make our dereplicated bin set is pick one bin from each cluster of bins that share &gt;99% ANI to be that clusters representative bin.</p> <p>We want the representative bins to be high quality, so pick the best bin by looking at each in ggKbase and picking the bin with the best single copy gene profile. If there are ties, pick one arbitrarily.</p> <p>This dereplicated bin set will be useful for future analyses, but we will not be using it for the rest of this week’s assignment.</p> <h1 id="comparing-synteny-between-bins-with-at-least-99-ani">Comparing synteny between bins with at least 99% ANI</h1> <p>Synteny is the shared order of genes among two or more organisms - essentially, a syntenic block is a group of genes in the same arrangement in multiple organisms. <code class="highlighter-rouge">Orthologer</code> is a program that takes two ordered lists of <strong>protein sequences</strong>, compares them to each other, and displays genes in the first organism that are reciprocal BLAST best hits in the other. While this program can accept multiple genomes as an input, I recommend only two genomes at a time.</p> <p>Look at your file <code class="highlighter-rouge">Secondary_clustering_dendrograms.pdf</code>. Each cluster has a separate dendrogram- choose one containing a genome from your sample- we are going to analyze two genomes from this cluster in the following section of this lab. (All the file names start with the sample the bin was obtained from!)</p> <h2 id="important-note-about-file-names">Important note about file names</h2> <p>I forgot to rename the protein fastas from <code class="highlighter-rouge">.fasta</code> to <code class="highlighter-rouge">.faa</code> before running dRep, so the clustering dendrograms are going to have file names that end in <code class="highlighter-rouge">.fasta</code>. I’ve since named them to prevent confusion: The DNA sequence files are in <code class="highlighter-rouge">/class_data/sample_bins/all_contigs/</code> and end in <code class="highlighter-rouge">.fna</code>; the protein/AA sequence files are in <code class="highlighter-rouge">/class_data/sample_bins/all_proteins/</code> and end in <code class="highlighter-rouge">.faa</code>.</p> <h2 id="running-orthologer">Running orthologer</h2> <p>Choose two genomes that are in this same primary cluster. Now, get the <em>protein</em> fasta files for those bins from the folder <code class="highlighter-rouge">/class_data/sample_bins/all_proteins/</code> and copy them into your home directory.</p> <p>I like to make directories before I run analyses, so let’s make one in our home directory (<code class="highlighter-rouge">mkdir ~/orthologer</code>) and copy these bins into it:</p> <div class="highlighter-rouge"><pre class="highlight"><code>mkdir ~/orthologer

cp /class_data/sample_bins/all_proteins/[YOUR FIRST CHOSEN BIN] ~/orthologer/
cp /class_data/sample_bins/all_proteins/[YOUR SECOND CHOSEN BIN] ~/orthologer/

</code></pre></div> <p>Now you’ve got those two (<strong>protein</strong>) fasta files in your <code class="highlighter-rouge">orthologer</code> directory, let’s go ahead and run <code class="highlighter-rouge">orthologer.py</code> to compare them. You’re going to have to use my installation of python, which is why I have those huge paths down below- just roll with it.</p> <p>Now take your two protein fastas (should end in <code class="highlighter-rouge">.faa</code>), which we’ll call <code class="highlighter-rouge">[FASTA1]</code> and <code class="highlighter-rouge">[FASTA2]</code>, and do the following:</p> <div class="highlighter-rouge"><pre class="highlight"><code>cd ~/orthologer
/home/jwestrob/.pyenv/shims/python /home/jwestrob/bin/bioscripts/ctbBio/orthologer.py reference [FASTA1] [FASTA2] &gt; genome_comparison.tsv
</code></pre></div> <p>Now you have a file called <code class="highlighter-rouge">genome_comparison.tsv</code> that you can download and open up in excel/google sheets. Give it a look- see how large the syntenic blocks are that these two genomes share. Remember, you can look up gene names in ggkbase and see what they do. (I will give a quick demo on this at the beginning of class.)</p> <hr /> <h1 id="todays-turn-in">Today’s turn-in</h1> <ol> <li> <p>Can you find any operons that these two genomes share? (From your orthologer output) What genes are encoded in these operons?</p> </li> <li> <p>What is the taxonomy of the two genomes you chose?</p> </li> <li> <p>Can you find any particularly large clusters in the primary clustering dendrogram? (<code class="highlighter-rouge">Primary_clustering_dendrogram.pdf</code>)Give the name of at least one bin from this cluster and look up its taxonomy on ggkbase.</p> </li> </ol> <div class="entry-meta"> <br> <hr> <span class="entry-tags"><a href="/tags/#test" title="Pages tagged test" class="tag"><span class="term">test</span></a></span> <span class="social-share"> <a href="https://www.facebook.com/sharer/sharer.php?u=/Week_7_Walkthrough/" title="Share on Facebook" class="tag"> <span class="term"><i class="fa fa-facebook-square"></i> Share</span> </a> <a href="https://twitter.com/intent/tweet?text=/Week_7_Walkthrough/" title="Share on Twitter" class="tag"> <span class="term"><i class="fa fa-twitter-square"></i> Tweet</span> </a> <a href="https://plus.google.com/share?url=/Week_7_Walkthrough/" title="Share on Google+" class="tag"> <span class="term"><i class="fa fa-google-plus-square"></i> +1</span> </a> </span> <div style="clear:both"></div> </div> </div> </div> </header> <!-- JS --> <script src="/assets/js/jquery-1.12.0.min.js"></script> <script src="/assets/js/jquery.dlmenu.min.js"></script> <script src="/assets/js/jquery.goup.min.js"></script> <script src="/assets/js/jquery.magnific-popup.min.js"></script> <script src="/assets/js/jquery.fitvid.min.js"></script> <script src="/assets/js/scripts.js"></script> <!-- MathJax --> <script async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>
